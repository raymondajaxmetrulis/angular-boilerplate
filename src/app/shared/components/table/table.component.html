<mat-sidenav-container *ngIf="(isLoading | async) === false">
  <mat-sidenav #sidenav mode="side" class="filter-sidenav medium ps-4 py-3">
    <h3>{{ "Generic_Filter_By" }}</h3>
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <section *ngFor="let field of formFields">
        <app-form-input [field]="field" [form]="form"> </app-form-input>
      </section>
      <div class="d-flex justify-content-center mt-2">
        <button
          type="submit"
          class="btn text-bg-nmftaprimary me-1 rounded-pill">
          {{ "Generic_Search" }}
        </button>
      </div>
    </form>
  </mat-sidenav>
  <div class="container w-100">
    <h1 class="mt-3">{{ title }}</h1>
    <div class="pt-2" *ngIf="filter">
      <mat-chip-option>
        <h4>{{ "Generic_SearchFilters" }}:</h4>
        <mat-chip
          *ngFor="let filter of filterDetails; let i = index"
          (removed)="removeFilter(i)">
          {{ filter[0] }}: {{ filter[1] }}
          <mat-icon matChipRemove>cancel</mat-icon>
        </mat-chip>
      </mat-chip-option>
    </div>
    <div
      class="w-100 mt-4 mb-2 d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center">
        <button mat-button class="me-3 search-btn" (click)="sidenav.toggle()">
          <mat-icon>search</mat-icon>
        </button>
        <button
          class="btn text-bg-nmftaprimary-danger me-1 rounded-pill"
          (click)="clearSearch()"
          *ngIf="!form.pristine">
          {{ "Generic_Clear_Search" }}
        </button>
        <span class="fw-bold">
          {{ "Generic_Found" }} {{ totalRows }} {{ "Generic_Result" }}
          <span *ngIf="totalRows > 1">s</span>
        </span>
      </div>
      <div class="d-flex justify-content-between align-items-center gap-2">
        <ng-container *ngIf="showFileAction">
          <input
            #file
            class="d-none"
            type="file"
            id="customFile"
            accept=".csv"
            (change)="fileAction.emit(file.files!)" />
          <button
            (click)="file.click()"
            class="btn icon-text-btn text-bg-nmftaprimary rounded-pill">
            <mat-icon>cloud_upload</mat-icon>{{ fileBtnText }}
          </button>
        </ng-container>
        <button
          *ngIf="showOuterActionOne"
          class="btn rounded-pill"
          [ngClass]="
            redOuterBtns.includes(0)
              ? 'text-bg-nmftaprimary-danger'
              : 'text-bg-nmftaprimary'
          "
          (click)="outerActionOne.emit()">
          {{ outerBtnsText[0] }}
        </button>
        <button
          *ngIf="showOuterActionTwo"
          class="btn rounded-pill"
          [ngClass]="
            redTableBtns.includes(1)
              ? 'text-bg-nmftaprimary-danger'
              : 'text-bg-nmftasecondary'
          "
          (click)="outerActionTwo.emit()">
          {{ outerBtnsText[1] }}
        </button>
      </div>
    </div>
    <table
      mat-table
      class="mat-elevation-z0 w-100"
      [dataSource]="dataSource"
      matSort
      (matSortChange)="sort($event)"
      [matSortActive]="activeSort"
      [matSortDirection]="sortDirection">
      <ng-container
        *ngFor="let column of displayedColumns!; let i = index"
        [matColumnDef]="column!">
        <th
          mat-sort-header
          class="large"
          *matHeaderCellDef
          [mat-sort-header]="column"
          [disabled]="
            disabledColumns.includes(column) || column === 'actionBtns'
          ">
          <ng-container *ngIf="column !== 'actionBtns'">
            {{ columnNames[i] }}
          </ng-container>
        </th>
        <td
          mat-cell
          *matCellDef="let row"
          [ngClass]="
            tableBtnsText.length && column === 'actionBtns'
              ? 'd-flex align-items-center justify-content-end gap-1'
              : ''
          ">
          <ng-container *ngIf="column !== 'actionBtns'">
            <ng-container *ngIf="row[column] !== false && row[column] !== true">
              <ng-container *ngIf="column.includes('Date')">
                {{ row[column] | date : "longDate" }}
              </ng-container>
              <ng-container *ngIf="!column.includes('Date')">
                {{ row[column] }}
              </ng-container>
            </ng-container>
            <img
              *ngIf="
                (row[column] === true && !flipBoolKeys.includes(column)) ||
                (row[column] === false && flipBoolKeys.includes(column))
              "
              class="check-icon ms-2"
              src="assets/icons/green-check.png"
              alt="Yes" />
            <img
              *ngIf="
                (row[column] === false && !flipBoolKeys.includes(column)) ||
                (row[column] === true && flipBoolKeys.includes(column))
              "
              class="check-icon ms-2"
              src="assets/icons/cancel-icon.png"
              alt="No" />
          </ng-container>
          <ng-container *ngIf="column === 'actionBtns'">
            <button
              *ngIf="tableBtnsText[0] && showTableActionOne(row)"
              class="btn rounded-pill"
              [ngClass]="
                redTableBtns.includes(0)
                  ? 'text-bg-nmftaprimary-danger'
                  : 'text-bg-nmftaprimary'
              "
              (click)="tableActionOne.emit(row)">
              {{ tableBtnsText[0] }}
            </button>
            <button
              *ngIf="tableBtnsText[1] && showTableActionTwo(row)"
              class="btn rounded-pill"
              [ngClass]="
                redTableBtns.includes(1)
                  ? 'text-bg-nmftaprimary-danger'
                  : 'text-bg-nmftaprimary'
              "
              (click)="tableActionTwo.emit(row)">
              {{ tableBtnsText[1] }}
            </button>
            <button
              *ngIf="tableBtnsText[2] && showTableActionThree(row)"
              class="btn rounded-pill"
              [ngClass]="
                redTableBtns.includes(2)
                  ? 'text-bg-nmftaprimary-danger'
                  : 'text-bg-nmftasecondary'
              "
              (click)="tableActionThree.emit(row)">
              {{ tableBtnsText[2] }}
            </button>
            <button
              *ngIf="tableBtnsText[3] && showTableActionFour(row)"
              class="btn rounded-pill"
              [ngClass]="
                redTableBtns.includes(3)
                  ? 'text-bg-nmftaprimary-danger'
                  : 'text-bg-nmftasecondary'
              "
              (click)="tableActionFour.emit(row)">
              {{ tableBtnsText[3] }}
            </button>
            <button
              *ngIf="tableBtnsText[4] && showTableActionFive(row)"
              class="btn rounded-pill"
              [ngClass]="
                redTableBtns.includes(4)
                  ? 'text-bg-nmftaprimary-danger'
                  : 'text-bg-nmftasecondary'
              "
              (click)="tableActionFive.emit(row)">
              {{ tableBtnsText[4] }}
            </button>
          </ng-container>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <mat-paginator
      #paginator
      class="w-100"
      [length]="totalRows"
      [pageSize]="pageSize"
      [pageSizeOptions]="[10, 25, 50, 100]"
      [pageIndex]="page - 1"
      [showFirstLastButtons]="true"
      aria-label="Select page"
      (page)="getServerData($event)">
    </mat-paginator>
  </div>
</mat-sidenav-container>

<ng-container *ngIf="isLoading | async">
  <div class="w-100 vh-100 d-flex justify-content-center align-items-center">
    <div class="w-100 m-auto">
      <img src="/assets/scac-logo.svg" class="scac-logo d-block m-auto mb-3" />
      <mat-progress-spinner class="m-auto" mode="indeterminate">
      </mat-progress-spinner>
    </div>
  </div>
</ng-container>
